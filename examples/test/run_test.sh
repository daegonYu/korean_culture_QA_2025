#!/usr/bin/env bash
set -e

system_prompt="당신은 한국의 문화와 관련된 문제를 전문적으로 풀이해주는 문제 해설가입니다.  
사용자가 입력한 문제에 대해 단계별로 차근차근(step by step) 설명하여 **문제 해설**과 **정답**을 제시하세요.  

답변 형식은 반드시 다음과 같이 작성하세요:  
문제 해설: (문제에 대한 배경, 개념 설명, 선택지 또는 정답 후보 분석 등 단계별로 논리적인 추론 과정을 포함)  
정답: (정답만 간결하게 작성)

※ 정답 작성 형식 안내  
- 선다형 문제일 경우: **정답 번호**만 작성하세요.  
- 단답형 문제일 경우:  
    - 정답이 1개인 경우: 괄호, 한자 없이 **한글** 또는 **영어**를 사용하세요. (예: 사과 또는 apple)  
    - 정답이 여러 개인 경우: 쉼표(,)로 구분해 나열하세요. (예: 사과, 배)  
    - 순서 배열 문제인 경우: '-'로 구분해 정확한 순서를 유지해 나열하세요. (예: ㄱ-ㄴ-ㄷ-ㄹ)"

user_prompt="아래 문제를 단계별로 자세히 해설해주고, 마지막에 정답을 작성해줘.  

키워드: {topic_keyword}  
문제 유형: {question_type}  
문제: {question}"

# system_prompt2="당신은 한국의 문화와 관련된 문제를 전문적으로 풀이해주는 문제 해설가입니다.  
# 사용자가 입력한 문제에 적절한 정답을 서술해주세요."
system_prompt2="당신은 한국의 문화와 관련된 문제에 대해 적절한 답변을 합니다."

user_prompt2="제시된 문제에 대해 적절한 정답을 작성해줘.  
**주어진 예시와 마찬가지로** 문제에 대한 적절한 설명을 포함하여 답변해줘.  
답변 형식은 줄바꿈 없이 여러 문장으로 구성하여 작성해줘.

예시1)
문제: 미국 학생들은 최소 10~11년간 의무교육을 받습니다. 한국에서 학생들이 받는 의무교육 기간은 몇 년이며, 그 범위는 어떻게 되나요?
정답: 한국의 의무교육은 초등학교 6년과 중학교 3년을 포함한 총 9년 동안 이루어지며, 일반적으로 만 6세에 시작해 만 15세까지 이어진다. 이 기간 동안 모든 아동은 국가로부터 무상으로 교육을 받을 권리를 가지며, 이는 헌법과 교육 관련 법률에 의해 보장된다. 학부모는 자녀를 반드시 학교에 입학시켜야 하며, 국가 역시 교육 환경을 마련할 책임이 있다. 고등학교 교육은 아직 의무교육에는 포함되지 않지만, 교육 기회의 평등을 위해 무상교육이 단계적으로 확대되고 있다. 2021년부터 고등학교 1학년부터 3학년까지 수업료와 입학금을 면제받는 제도가 시행되고 있으며, 이는 가계 부담을 줄이고 학생들의 교육 접근성을 높이는 데 기여하고 있다.

예시2)
문제: 한국의 ‘서예’와 이슬람 문화권의 ‘캘리그래피’가 공유하는 조형상의 특징을 서술하고 그 차이점이 있다면 함께 설명하세요.
정답: 한국의 서예와 이슬람 문화권의 캘리그래피는 모두 문자를 단순한 전달 수단이 아닌 예술적 조형 표현으로 승화시켰다는 공통점을 가진다. 두 문화권 모두 글자 자체의 형과 선, 리듬과 균형을 중시하며, 필법과 구도의 미학을 통해 정서와 철학을 전달한다. 한국 서예는 주로 한자와 한글을 사용하며, 붓의 농담과 필획의 유려함, 여백의 미를 통해 정신성을 강조하고 자연과의 조화를 중시한다. 반면 이슬람 캘리그래피는 꾸란의 경전을 미화하기 위한 목적으로 발달했으며, 아랍 문자를 기하학적·추상적으로 배열하여 장식성과 반복미를 강조한다. 이슬람 전통에서는 우상 숭배 금지로 인해 문자 자체가 시각예술의 중심이 되었고, 건축물과 도자기 등에도 광범위하게 활용되며 종교적 신성함을 표현하는 매개체로 기능한다는 점에서 차이를 보인다.

예시3)
문제: 한국에서는 상견례 장소를 정할 때 어떻게 정하나요?
정답: 한국 사회에서 상견례는 예비 신랑·신부와 양가 부모가 공식적으로 처음 만나 혼인을 최종적으로 승인하고 이후 절차를 의논하는 중요한 예식이다. 따라서 상견례를 어디에서 진행하느냐 역시 중요한 문제가 된다. 한국에서 상견례는 일반적으로 호텔이나 한정식집, 고급 식당 등 조용한 분위기의 식당에서 이루어진다. 또한 장소는 양가의 중간 정도 위치로 정하거나 양가 부모님의 거동이나 연배 등을 고려하여 정하기도 한다. 음식 선정 시에는 조용하게 대화하면서 먹을 수 있고 깔끔한 음식이면 가능하나, 양가 부모의 음식선호도 고려하여 준비한다.

예시4)
문제: 한국에서 아홉수의 의미와 이에 대한 사람들의 태도는 무엇인지 서술하세요.
정답: 한국에서 '아홉수'는 29살, 39살처럼 숫자 9가 들어간 나이를 뜻하며 이 시기를 운이 좋지 않은 때로 여겨 결혼이나 이사, 사업과 같은 중요한 일을 피하려는 경향이 있다. 한국인들은 아홉수에 대해 불안감을 가지며 조심스러운 태도를 보인다. 평소 미신을 믿지 않는 한국인들도 이 나이만큼은 신중하게 행동하는 경우가 많다. 이러한 현상은 숫자에 특별한 의미를 부여하는 수비주의적 성향과도 관련이 있으며 인간이 변화보다 안정을 선호하는 본능이 반영된 것이다. 흥미로운 점은 9가 본래 길한 숫자인 3이 세 번 더해진 수이지만 아홉수는 유독 한국에서만 불길하게 인식된다는 점이다.

예시5)
문제: 한국의 오방처용무와 중국의 오방사자춤을 중심으로 한국과 중국의 궁중 전통 무용의 공통점이 무엇인지 서술하세요.
정답: 한국의 처용무와 중국의 오사자춤은 모두 궁중에서 행해진 대표적인 전통 무용으로, 국가의 평안과 잡귀를 물리치기 위한 의례적인 목적을 가지고 있다. 두 무용 모두 오방 사상에 기반하여 다섯 방향과 색을 상징하는 인물이 등장하며, 그 상징은 복식과 동작에도 명확하게 반영되어 있다. 또한 이들 무용은 단순한 춤 동작에 그치지 않고, 전통 음악과 노래가 함께 어우러지는 종합예술로서의 특성을 지니고 있다는 공통점이 있다. 더불어 왕실이나 국가 차원의 공식 행사에서 연행되었으며, 정해진 형식과 절차에 따라 엄격하게 구성되어 오랜 세월 전통적으로 계승되어 왔다는 점에서도 유사한 특징을 지닌다.

예시6)
문제: 한국의 여성 설치미술가인 이불의 작품은 어떤 방향성과 철학을 중심으로 전개되고 있나요?
정답: 이불은 초기에는 기존 질서를 해체하는 퍼포먼스를 통해 도전적인 시각을 드러냈으며, 이후에는 유토피아와 기술, 신체와 권력, 역사적 기억 등 복합적인 주제를 탐구하며 독창적인 예술 세계를 구축해왔다. 다양한 재료와 형식을 넘나들며 감각 간 경계를 허물어온 그는, 최근 진행한 전시에서는 처음으로 판화 매체를 통해 자신의 조형 언어를 확장하는 시도를 선보였다. 이 전시는 구리 분말, 철 가루, 금속박 등 비전통적 재료와 스크린 기법을 활용해 판화의 물성과 개념적 가능성을 실험하였다. 이는 그간의 조각과 설치 작업에서 중심적으로 다뤄온 아름다움과 쇠퇴, 기술과 실패, 이상과 현실 사이의 긴장을 평면 위로 다시 구성하는 작업이라 할 수 있다.

예시7)
문제: 조선 시대 제작된 천체관측기구 혼천의에 대해 설명하세요.
정답: 혼천의는 천문학의 기본적인 기구로서 조선시대 천문역법(天文曆法)의 표준시계와 같은 구실을 한 기구이다. 1433년 세종 즉위 15년 정인지, 정초 등이 왕명을 받아 진행한 고전 조사를 바탕으로 이천, 장영실의 감독을 통해 조선 최초의 혼천의가 제작되었다. 효종 즉위 8년에는 최유지가 시계장치를 사용하여 제작하였고, 현종 10년에는 이민철과 송이영이 혼천의를 제작하였다. 현종 시기 혼천의는 서양식 자명종의 원리와 특징을 도입하여 추를 시계 장치의 동력으로 이용하였다.

예시8)
문제: 유럽과 비교되는 국내 전력 산업의 특성은 무엇인가요?
정답: 한국 전력산업의 특성은 유럽과 비교할 때 몇 가지 뚜렷한 차이를 보인다. 첫째, 에너지의 해외 의존도가 매우 높다는 점이다. 국내에서 소비되는 에너지 대부분이 해외에서 수입된 자원에 기반하고 있어, 국제 에너지 시장의 불안정성에 민감하게 반응할 수밖에 없다. 따라서 국가적으로 안정적인 에너지 확보가 중요한 과제가 된다. 둘째, 지정학적 특성상 전력 계통이 주변국과 연결되어 있지 않다는 점이다. 한국은 반도 국가로서, 육상으로 인접한 북한과의 교류가 단절되어 있으며, 일본 및 중국과는 전력망이 연결되어 있지 않다. 이로 인해 유럽처럼 국가 간 전력 수출입이나 계통 연계를 통한 유연한 수급 조절이 불가능하다. 이러한 구조적 한계는 국내 전력 수급의 자립성과 안정성을 더욱 중요하게 만들며, 에너지 안보 확보를 위한 장기적인 전략이 요구된다.

---

실제 문제)
문제: {question}
정답:"

answer_tag="정답:"


paths=(
    "/workspace/korean_culture_QA_2025/models/grpo_v6_Midm-2.0-Base-Instruct_curri_선다형_단답형_v1_prompt2/checkpoint-483"
)

for model in "${paths[@]}"; do
    echo "🔍 현재 경로: $model"
    nohup python run_phase1.py --model "$model" --use_test --use_wandb --use_lora \
    --system_prompt "$system_prompt" --user_prompt "$user_prompt" --answer_tag "$answer_tag" --max_lora_rank 64 \
    --system_prompt2 "$system_prompt2" --user_prompt2 "$user_prompt2"

    dir_name=$(basename $(dirname "$model"))   # "grpo_v2_A.X-4.0-Light_선다형_단답형"
    checkpoint=$(basename "$model")            # "checkpoint-112"
    model_name="${dir_name}_${checkpoint}"     # "grpo_v2_A.X-4.0-Light_선다형_단답형_checkpoint-112"

    echo "Model name: $model_name"

    json_path="results/phase1_${model_name}_test_outputs.json"
    echo "Scoring: $json_path"
    python score_only_answer.py --json_path "$json_path" --answer_tag "$answer_tag"
done